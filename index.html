<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>DolbaebSMS - Secure Messenger</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'] },
            colors: {
              gray: { 750: '#2d3748', 850: '#1a202c', 950: '#0d1117' }
            },
            animation: {
              'fade-in': 'fadeIn 0.3s ease-out',
              'slide-up': 'slideUp 0.3s ease-out',
              'pulse-gold': 'pulseGold 2s infinite',
              'spin-slow': 'spin 3s linear infinite',
              'bounce-in': 'bounceIn 0.6s ease-out',
              'shake': 'shake 0.5s ease-in-out',
            },
            keyframes: {
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              slideUp: { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
              pulseGold: { '0%, 100%': { transform: 'scale(1)', opacity: '1' }, '50%': { transform: 'scale(1.05)', opacity: '0.8' } },
              bounceIn: {
                '0%': { transform: 'scale(0.3)', opacity: '0' },
                '50%': { transform: 'scale(1.05)', opacity: '0.8' },
                '70%': { transform: 'scale(0.9)', opacity: '0.9' },
                '100%': { transform: 'scale(1)', opacity: '1' }
              },
              shake: {
                '0%, 100%': { transform: 'translateX(0)' },
                '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-5px)' },
                '20%, 40%, 60%, 80%': { transform: 'translateX(5px)' }
              }
            }
          }
        }
      }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Babel for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Styles -->
    <style>
      body { background-color: #0f172a; color: #e2e8f0; overscroll-behavior-y: none; }
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #475569; }
      .custom-scrollbar::-webkit-scrollbar { width: 5px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
      
      /* Frame styles */
      .frame-basic { border: 2px solid #6b7280; box-shadow: 0 0 5px rgba(107, 114, 128, 0.5); }
      .frame-silver { border: 3px solid #c0c0c0; box-shadow: 0 0 10px rgba(192, 192, 192, 0.7); }
      .frame-gold { border: 3px solid #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
      .frame-diamond { border: 3px solid #b9f2ff; box-shadow: 0 0 20px rgba(185, 242, 255, 0.9); }
      .frame-rainbow { 
        border: 3px solid transparent;
        background: linear-gradient(45deg, #ff0000, #ff9900, #ffff00, #00ff00, #00ffff, #0000ff, #9900ff) border-box;
        box-shadow: 0 0 25px rgba(255, 255, 255, 0.5);
      }
      
      /* Casino styles */
      .slot-machine {
        background: linear-gradient(135deg, #1e40af, #3730a3);
        border: 3px solid #fbbf24;
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
      }
      
      .slot-reel {
        background: linear-gradient(135deg, #0f172a, #1e293b);
        border: 2px solid #475569;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      }
      
      .roulette-table {
        background: linear-gradient(135deg, #15803d, #166534);
        border: 3px solid #fbbf24;
      }
      
      .dice-table {
        background: linear-gradient(135deg, #7e22ce, #6b21a8);
        border: 3px solid #fbbf24;
      }
      
      .bet-chip {
        animation: pulseGold 2s infinite;
      }
      
      .win-animation {
        animation: bounceIn 0.6s ease-out, pulseGold 2s infinite;
      }
      
      .lose-animation {
        animation: shake 0.5s ease-in-out;
      }
      
      /* Mobile optimizations */
      @media (max-width: 640px) {
        .safe-area-bottom { padding-bottom: max(1rem, env(safe-area-inset-bottom)); }
        /* Hide scrollbar on mobile for cleaner look */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      }

      .coin-animation {
        animation: coinPop 0.5s ease-out;
      }

      @keyframes coinPop {
        0% { transform: scale(0.5); opacity: 0; }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); opacity: 1; }
      }

      .avatar-locked {
        filter: grayscale(1) brightness(0.5);
        position: relative;
      }

      .avatar-locked::after {
        content: "üîí";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 24px;
        z-index: 10;
      }
    </style>

    <!-- Import Map -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0",
    "date-fns": "https://esm.sh/date-fns@2.30.0",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
    "firebase/database": "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Search, Send, Image as ImageIcon, Mic, X, ChevronLeft, Video, Settings as SettingsIcon, Menu, Trash2, Smile, MoreVertical, Lock, LogOut, User as UserIcon, Loader2, Coins, Zap, Crown, Dice5, Circle, SlotMachine } from 'lucide-react';
        import { format } from 'date-fns';
        import { initializeApp } from 'firebase/app';
        import { getDatabase, ref, onValue, set, update, push, off, query, orderByChild, startAt, endAt, remove, get } from 'firebase/database';

        // --- Services ---
        const firebaseConfig = {
            apiKey: "AIzaSyA35T6z2FYS6m9IEJ9x7evxCphgpLhgMX4",
            authDomain: "dolbaebsms-live.firebaseapp.com",
            databaseURL: "https://dolbaebsms-live-default-rtdb.firebaseio.com",
            projectId: "dolbaebsms-live",
            storageBucket: "dolbaebsms-live.firebasestorage.app",
            messagingSenderId: "912825721862",
            appId: "1:912825721862:web:b92d7f7f553ca4536c0f87",
            measurementId: "G-SCD5JVFM5E"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- Components ---

        // 1. Button
        const Button = ({ children, variant = 'primary', className = '', isLoading, icon, ...props }) => {
            const baseStyles = "relative flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-indigo-600 hover:bg-indigo-500 text-white shadow-lg shadow-indigo-500/20",
                secondary: "bg-slate-700 hover:bg-slate-600 text-slate-100 border border-slate-600",
                danger: "bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/20",
                ghost: "bg-transparent hover:bg-white/5 text-slate-300",
                gold: "bg-yellow-500 hover:bg-yellow-400 text-white shadow-lg shadow-yellow-500/20",
                success: "bg-green-600 hover:bg-green-500 text-white shadow-lg shadow-green-500/20"
            };
            return (
                <button className={`${baseStyles} ${variants[variant]} ${className}`} disabled={isLoading || props.disabled} {...props}>
                    {isLoading ? (
                        <Loader2 className="animate-spin h-5 w-5" />
                    ) : (<>{icon && <span className="text-lg">{icon}</span>}{children}</>)}
                </button>
            );
        };

        // 2. Casino Modal
        const CasinoModal = ({ isOpen, onClose, currentUser, userCoins, onCoinsUpdate }) => {
            const [activeGame, setActiveGame] = useState('slots');
            const [betAmount, setBetAmount] = useState(10);
            const [isSpinning, setIsSpinning] = useState(false);
            const [slotResult, setSlotResult] = useState(['üçí', 'üçã', 'üçä']);
            const [diceResult, setDiceResult] = useState([1, 1]);
            const [rouletteResult, setRouletteResult] = useState(0);
            const [gameMessage, setGameMessage] = useState('');
            const [lastWin, setLastWin] = useState(0);

            if (!isOpen) return null;

            const slotSymbols = ['üçí', 'üçã', 'üçä', 'üçá', 'üîî', '‚≠ê', 'üíé', '7Ô∏è‚É£'];
            
            const playSlots = async () => {
                if (userCoins < betAmount) {
                    setGameMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏!');
                    return;
                }

                setIsSpinning(true);
                setGameMessage('–ö—Ä—É—Ç–∏–º...');

                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
                for (let i = 0; i < 10; i++) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    setSlotResult([
                        slotSymbols[Math.floor(Math.random() * slotSymbols.length)],
                        slotSymbols[Math.floor(Math.random() * slotSymbols.length)],
                        slotSymbols[Math.floor(Math.random() * slotSymbols.length)]
                    ]);
                }

                // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const finalResult = [
                    slotSymbols[Math.floor(Math.random() * slotSymbols.length)],
                    slotSymbols[Math.floor(Math.random() * slotSymbols.length)],
                    slotSymbols[Math.floor(Math.random() * slotSymbols.length)]
                ];
                
                setSlotResult(finalResult);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞
                let winMultiplier = 0;
                if (finalResult[0] === finalResult[1] && finalResult[1] === finalResult[2]) {
                    if (finalResult[0] === '7Ô∏è‚É£') winMultiplier = 10;
                    else if (finalResult[0] === 'üíé') winMultiplier = 8;
                    else if (finalResult[0] === '‚≠ê') winMultiplier = 6;
                    else if (finalResult[0] === 'üîî') winMultiplier = 5;
                    else winMultiplier = 3;
                } else if (finalResult[0] === finalResult[1] || finalResult[1] === finalResult[2]) {
                    winMultiplier = 2;
                }

                const winAmount = betAmount * winMultiplier;
                const newCoins = userCoins - betAmount + winAmount;
                
                await update(ref(db, `users/${currentUser}`), { 
                    coins: newCoins 
                });
                
                onCoinsUpdate(newCoins);
                
                if (winMultiplier > 0) {
                    setGameMessage(`üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} –∫–æ–∏–Ω–æ–≤!`);
                    setLastWin(winAmount);
                } else {
                    setGameMessage('üòû –ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!');
                    setLastWin(0);
                }
                
                setIsSpinning(false);
            };

            const playDice = async () => {
                if (userCoins < betAmount) {
                    setGameMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏!');
                    return;
                }

                setIsSpinning(true);
                setGameMessage('–ë—Ä–æ—Å–∞–µ–º –∫–æ—Å—Ç–∏...');

                // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞
                for (let i = 0; i < 8; i++) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    setDiceResult([
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1
                    ]);
                }

                // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const finalResult = [
                    Math.floor(Math.random() * 6) + 1,
                    Math.floor(Math.random() * 6) + 1
                ];
                
                setDiceResult(finalResult);
                
                const sum = finalResult[0] + finalResult[1];
                let winMultiplier = 0;
                
                if (sum === 7) winMultiplier = 4;
                else if (sum === 11) winMultiplier = 3;
                else if (sum === 2 || sum === 12) winMultiplier = 5;
                else if (sum >= 8 && sum <= 10) winMultiplier = 2;

                const winAmount = betAmount * winMultiplier;
                const newCoins = userCoins - betAmount + winAmount;
                
                await update(ref(db, `users/${currentUser}`), { 
                    coins: newCoins 
                });
                
                onCoinsUpdate(newCoins);
                
                if (winMultiplier > 0) {
                    setGameMessage(`üé≤ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} –∫–æ–∏–Ω–æ–≤! –°—É–º–º–∞: ${sum}`);
                    setLastWin(winAmount);
                } else {
                    setGameMessage(`üòû –°—É–º–º–∞: ${sum}. –ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!`);
                    setLastWin(0);
                }
                
                setIsSpinning(false);
            };

            const playRoulette = async () => {
                if (userCoins < betAmount) {
                    setGameMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏!');
                    return;
                }

                setIsSpinning(true);
                setGameMessage('–ö—Ä—É—Ç–∏–º —Ä—É–ª–µ—Ç–∫—É...');

                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
                for (let i = 0; i < 15; i++) {
                    await new Promise(resolve => setTimeout(resolve, 80));
                    setRouletteResult(Math.floor(Math.random() * 37));
                }

                // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const finalResult = Math.floor(Math.random() * 37);
                setRouletteResult(finalResult);
                
                let winMultiplier = 0;
                if (finalResult === 0) {
                    winMultiplier = 35;
                } else if (finalResult % 2 === 0) {
                    winMultiplier = 2;
                } else {
                    winMultiplier = 0;
                }

                const winAmount = betAmount * winMultiplier;
                const newCoins = userCoins - betAmount + winAmount;
                
                await update(ref(db, `users/${currentUser}`), { 
                    coins: newCoins 
                });
                
                onCoinsUpdate(newCoins);
                
                if (winMultiplier > 0) {
                    setGameMessage(`üé° –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} –∫–æ–∏–Ω–æ–≤! –í—ã–ø–∞–ª–æ: ${finalResult}`);
                    setLastWin(winAmount);
                } else {
                    setGameMessage(`‚ö´ –í—ã–ø–∞–ª–æ: ${finalResult}. –ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!`);
                    setLastWin(0);
                }
                
                setIsSpinning(false);
            };

            const getRouletteColor = (number) => {
                if (number === 0) return 'bg-green-600';
                return number % 2 === 0 ? 'bg-red-600' : 'bg-black';
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
                    <div className="w-full max-w-4xl bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                        <div className="p-4 border-b border-slate-800 flex items-center justify-between bg-slate-900">
                            <h2 className="text-xl font-bold text-white flex items-center gap-2">üé∞ –ö–∞–∑–∏–Ω–æ Dolbaeb</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><X size={24} /></button>
                        </div>
                        
                        <div className="flex border-b border-slate-800 bg-slate-900/50">
                            {[
                                { id: 'slots', name: '–°–ª–æ—Ç—ã', icon: <SlotMachine size={16} /> },
                                { id: 'dice', name: '–ö–æ—Å—Ç–∏', icon: <Dice5 size={16} /> },
                                { id: 'roulette', name: '–†—É–ª–µ—Ç–∫–∞', icon: <Circle size={16} /> }
                            ].map(game => (
                                <button 
                                    key={game.id}
                                    onClick={() => setActiveGame(game.id)}
                                    className={`flex-1 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2 ${
                                        activeGame === game.id ? 'text-yellow-400 border-b-2 border-yellow-400' : 'text-slate-400'
                                    }`}
                                >
                                    {game.icon}
                                    {game.name}
                                </button>
                            ))}
                        </div>

                        <div className="p-6 overflow-y-auto custom-scrollbar flex-1 bg-slate-900">
                            {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ */}
                            <div className="text-center mb-6">
                                <div className="bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 inline-block">
                                    <div className="flex items-center justify-center gap-2 text-yellow-500">
                                        <Coins size={24} />
                                        <span className="font-bold text-xl">{userCoins.toFixed(3)} –∫–æ–∏–Ω–æ–≤</span>
                                    </div>
                                </div>
                                {lastWin > 0 && (
                                    <div className="mt-2 win-animation">
                                        <span className="text-green-400 font-bold text-lg">+{lastWin} –∫–æ–∏–Ω–æ–≤!</span>
                                    </div>
                                )}
                            </div>

                            {/* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–æ–π */}
                            <div className="mb-6 p-4 bg-slate-800 rounded-xl">
                                <div className="flex items-center justify-between mb-3">
                                    <span className="text-slate-300">–°—Ç–∞–≤–∫–∞:</span>
                                    <span className="text-yellow-400 font-bold">{betAmount} –∫–æ–∏–Ω–æ–≤</span>
                                </div>
                                <div className="flex gap-2 mb-3">
                                    {[10, 50, 100, 500].map(amount => (
                                        <button
                                            key={amount}
                                            onClick={() => setBetAmount(amount)}
                                            className={`flex-1 py-2 rounded-lg transition-all ${
                                                betAmount === amount 
                                                    ? 'bg-yellow-500 text-white' 
                                                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                            }`}
                                        >
                                            {amount}
                                        </button>
                                    ))}
                                </div>
                                <div className="flex items-center gap-3">
                                    <input
                                        type="range"
                                        min="10"
                                        max="1000"
                                        step="10"
                                        value={betAmount}
                                        onChange={(e) => setBetAmount(parseInt(e.target.value))}
                                        className="flex-1"
                                    />
                                    <span className="text-slate-400 text-sm min-w-[60px] text-right">{betAmount}</span>
                                </div>
                            </div>

                            {/* –ò–≥—Ä–æ–≤—ã–µ –∑–æ–Ω—ã */}
                            {activeGame === 'slots' && (
                                <div className="space-y-6">
                                    <div className="slot-machine rounded-2xl p-6 text-center">
                                        <div className="flex justify-center gap-4 mb-6">
                                            {slotResult.map((symbol, index) => (
                                                <div key={index} className="slot-reel w-20 h-20 rounded-lg flex items-center justify-center text-4xl">
                                                    {symbol}
                                                </div>
                                            ))}
                                        </div>
                                        <Button
                                            onClick={playSlots}
                                            isLoading={isSpinning}
                                            variant="gold"
                                            className="w-full py-4 text-lg"
                                            icon={<SlotMachine size={20} />}
                                        >
                                            –ö—Ä—É—Ç–∏—Ç—å —Å–ª–æ—Ç—ã
                                        </Button>
                                    </div>
                                    
                                    <div className="bg-slate-800/50 rounded-xl p-4">
                                        <h3 className="text-yellow-400 font-bold mb-2">–ü—Ä–∞–≤–∏–ª–∞ —Å–ª–æ—Ç–æ–≤:</h3>
                                        <div className="text-sm text-slate-300 space-y-1">
                                            <p>üé∞ 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞ = x3-x10</p>
                                            <p>üé∞ 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞ = x2</p>
                                            <p>üíé –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç—ã = x8 | ‚≠ê –ó–≤–µ–∑–¥—ã = x6</p>
                                            <p>üîî –ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫ = x5 | 7Ô∏è‚É£ –°–µ–º–µ—Ä–∫–∏ = x10</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeGame === 'dice' && (
                                <div className="space-y-6">
                                    <div className="dice-table rounded-2xl p-6 text-center">
                                        <div className="flex justify-center gap-6 mb-6">
                                            {diceResult.map((value, index) => (
                                                <div key={index} className="slot-reel w-16 h-16 rounded-lg flex items-center justify-center text-2xl font-bold">
                                                    {value}
                                                </div>
                                            ))}
                                        </div>
                                        <Button
                                            onClick={playDice}
                                            isLoading={isSpinning}
                                            variant="success"
                                            className="w-full py-4 text-lg"
                                            icon={<Dice5 size={20} />}
                                        >
                                            –ë—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏
                                        </Button>
                                    </div>
                                    
                                    <div className="bg-slate-800/50 rounded-xl p-4">
                                        <h3 className="text-green-400 font-bold mb-2">–ü—Ä–∞–≤–∏–ª–∞ –∫–æ—Å—Ç–µ–π:</h3>
                                        <div className="text-sm text-slate-300 space-y-1">
                                            <p>üé≤ –°—É–º–º–∞ 7 = x4</p>
                                            <p>üé≤ –°—É–º–º–∞ 11 = x3</p>
                                            <p>üé≤ –°—É–º–º–∞ 2 –∏–ª–∏ 12 = x5</p>
                                            <p>üé≤ –°—É–º–º–∞ 8-10 = x2</p>
                                            <p>üé≤ –û—Å—Ç–∞–ª—å–Ω—ã–µ = –ø—Ä–æ–∏–≥—Ä—ã—à</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeGame === 'roulette' && (
                                <div className="space-y-6">
                                    <div className="roulette-table rounded-2xl p-6 text-center">
                                        <div className="mb-6">
                                            <div className={`inline-flex items-center justify-center w-16 h-16 rounded-full ${getRouletteColor(rouletteResult)} text-white font-bold text-xl border-2 border-white`}>
                                                {rouletteResult}
                                            </div>
                                        </div>
                                        <Button
                                            onClick={playRoulette}
                                            isLoading={isSpinning}
                                            variant="danger"
                                            className="w-full py-4 text-lg"
                                            icon={<Circle size={20} />}
                                        >
                                            –ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É
                                        </Button>
                                    </div>
                                    
                                    <div className="bg-slate-800/50 rounded-xl p-4">
                                        <h3 className="text-red-400 font-bold mb-2">–ü—Ä–∞–≤–∏–ª–∞ —Ä—É–ª–µ—Ç–∫–∏:</h3>
                                        <div className="text-sm text-slate-300 space-y-1">
                                            <p>üî¥ –ß–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ = x2</p>
                                            <p>‚ö´ –ù–µ—á–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ = –ø—Ä–æ–∏–≥—Ä—ã—à</p>
                                            <p>üü¢ –ù–æ–ª—å (0) = x35</p>
                                            <p>üéØ –®–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞: 48.6%</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ */}
                            {gameMessage && (
                                <div className={`mt-4 p-4 rounded-xl text-center font-medium ${
                                    gameMessage.includes('–≤—ã–∏–≥—Ä–∞–ª–∏') 
                                        ? 'bg-green-500/20 text-green-400 win-animation' 
                                        : gameMessage.includes('–ü–æ–≤–µ–∑–µ—Ç') || gameMessage.includes('–ø—Ä–æ–∏–≥—Ä—ã—à')
                                        ? 'bg-red-500/20 text-red-400 lose-animation'
                                        : 'bg-blue-500/20 text-blue-400'
                                }`}>
                                    {gameMessage}
                                </div>
                            )}

                            {/* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ */}
                            <div className="mt-6 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-center">
                                <p className="text-red-400 text-sm">üé∞ –ò–≥—Ä–∞–π—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ! –ù–µ —Ä–∏—Å–∫—É–π—Ç–µ –±–æ–ª—å—à–µ, —á–µ–º –º–æ–∂–µ—Ç–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –ø–æ—Ç–µ—Ä—è—Ç—å.</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Avatar Modal (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ —Å–æ–∫—Ä–∞—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)
        const AvatarModal = ({ isOpen, onClose, currentUser, userCoins, onAvatarChange, purchasedAvatars }) => {
            const [selectedAvatar, setSelectedAvatar] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const avatars = [
                { emoji: 'üê∂', price: 10, name: '–°–æ–±–∞–∫–∞' },
                { emoji: 'üê±', price: 15, name: '–ö–æ—à–∫–∞' },
                { emoji: 'üê≠', price: 20, name: '–ú—ã—à—å' },
                { emoji: 'üêπ', price: 25, name: '–•–æ–º—è–∫' },
                { emoji: 'üê∞', price: 30, name: '–ö—Ä–æ–ª–∏–∫' },
                { emoji: 'ü¶ä', price: 35, name: '–õ–∏—Å–∞' },
                { emoji: 'üêª', price: 40, name: '–ú–µ–¥–≤–µ–¥—å' },
                { emoji: 'üêº', price: 45, name: '–ü–∞–Ω–¥–∞' },
                { emoji: 'üê®', price: 50, name: '–ö–æ–∞–ª–∞' },
                { emoji: 'üêØ', price: 60, name: '–¢–∏–≥—Ä' }
            ];

            if (!isOpen) return null;

            const handleAvatarSelect = async (avatar) => {
                if (userCoins < avatar.price && currentUser !== 'kayivi') {
                    alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤! –ù—É–∂–Ω–æ ${avatar.price} –∫–æ–∏–Ω–æ–≤ –¥–ª—è —ç—Ç–æ–π –∞–≤–∞—Ç–∞—Ä–∫–∏.`);
                    return;
                }

                setIsLoading(true);
                try {
                    if (currentUser !== 'kayivi') {
                        await update(ref(db, `users/${currentUser}`), { 
                            coins: userCoins - avatar.price,
                            avatar: avatar.emoji
                        });
                    } else {
                        await update(ref(db, `users/${currentUser}`), { 
                            avatar: avatar.emoji
                        });
                    }
                    setSelectedAvatar(avatar.emoji);
                    onAvatarChange(avatar.emoji);
                    onClose();
                } catch (error) {
                    console.error('Avatar change error:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∞–≤–∞—Ç–∞—Ä–∫–∏');
                }
                setIsLoading(false);
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
                    <div className="w-full max-w-4xl bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                        <div className="p-4 border-b border-slate-800 flex items-center justify-between bg-slate-900">
                            <h2 className="text-xl font-bold text-white flex items-center gap-2"><UserIcon size={20} className="text-yellow-500" /> –ú–∞–≥–∞–∑–∏–Ω –∞–≤–∞—Ç–∞—Ä–æ–∫</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><X size={24} /></button>
                        </div>
                        <div className="p-6 overflow-y-auto custom-scrollbar flex-1 bg-slate-900">
                            <div className="text-center mb-6">
                                <p className="text-slate-400">
                                    {currentUser === 'kayivi' ? (
                                        <span className="text-yellow-500 flex items-center justify-center gap-2">
                                            <Crown size={16} /> –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±–∏—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ!
                                        </span>
                                    ) : (
                                        <span>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É –¥–ª—è –ø–æ–∫—É–ø–∫–∏</span>
                                    )}
                                </p>
                                <p className="text-sm text-slate-500 mt-2">–í–∞—à–∏ –∫–æ–∏–Ω—ã: <span className="text-yellow-500 font-bold">{userCoins.toFixed(3)}</span></p>
                            </div>
                            <div className="grid grid-cols-4 md:grid-cols-5 gap-4">
                                {avatars.map((avatar, index) => {
                                    const canAfford = userCoins >= avatar.price || currentUser === 'kayivi';
                                    const isLocked = !canAfford && currentUser !== 'kayivi';
                                    
                                    return (
                                        <button
                                            key={index}
                                            onClick={() => !isLocked && handleAvatarSelect(avatar)}
                                            disabled={isLoading || isLocked}
                                            className={`p-4 rounded-xl flex flex-col items-center gap-2 transition-all duration-200 ${
                                                isLocked 
                                                    ? 'bg-slate-800 border-2 border-slate-700 avatar-locked' 
                                                    : 'bg-slate-800 hover:bg-slate-700 border-2 border-slate-600 hover:border-yellow-500 hover:scale-105'
                                            }`}
                                        >
                                            <div className="text-4xl">{avatar.emoji}</div>
                                            <div className="text-center">
                                                <h3 className="font-medium text-white text-sm">{avatar.name}</h3>
                                                <p className="text-sm text-slate-400">
                                                    {currentUser === 'kayivi' ? (
                                                        <span className="text-yellow-500">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                                                    ) : (
                                                        `${avatar.price} –∫–æ–∏–Ω–æ–≤`
                                                    )}
                                                </p>
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 4. Frame Modal (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ —Å–æ–∫—Ä–∞—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)
        const FrameModal = ({ isOpen, onClose, currentUser, userCoins, onFrameChange, userFrame }) => {
            const [selectedFrame, setSelectedFrame] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const frames = [
                { id: 'none', name: '–ë–µ–∑ —Ä–∞–º–∫–∏', price: 0, className: '' },
                { id: 'basic', name: '–ë–∞–∑–æ–≤–∞—è —Ä–∞–º–∫–∞', price: 10, className: 'frame-basic' },
                { id: 'silver', name: '–°–µ—Ä–µ–±—Ä—è–Ω–∞—è —Ä–∞–º–∫–∞', price: 50, className: 'frame-silver' },
                { id: 'gold', name: '–ó–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞', price: 100, className: 'frame-gold' },
                { id: 'diamond', name: '–ê–ª–º–∞–∑–Ω–∞—è —Ä–∞–º–∫–∞', price: 250, className: 'frame-diamond' },
                { id: 'rainbow', name: '–†–∞–¥—É–∂–Ω–∞—è —Ä–∞–º–∫–∞', price: 500, className: 'frame-rainbow' }
            ];

            if (!isOpen) return null;

            const handleFrameSelect = async (frame) => {
                if (userCoins < frame.price && currentUser !== 'kayivi') {
                    alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤! –ù—É–∂–Ω–æ ${frame.price} –∫–æ–∏–Ω–æ–≤ –¥–ª—è —ç—Ç–æ–π —Ä–∞–º–∫–∏.`);
                    return;
                }

                setIsLoading(true);
                try {
                    if (currentUser !== 'kayivi') {
                        await update(ref(db, `users/${currentUser}`), { 
                            coins: userCoins - frame.price,
                            frame: frame.id
                        });
                    } else {
                        await update(ref(db, `users/${currentUser}`), { 
                            frame: frame.id
                        });
                    }
                    setSelectedFrame(frame.id);
                    onFrameChange(frame.id);
                    onClose();
                } catch (error) {
                    console.error('Frame change error:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Ä–∞–º–∫–∏');
                }
                setIsLoading(false);
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
                    <div className="w-full max-w-2xl bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                        <div className="p-4 border-b border-slate-800 flex items-center justify-between bg-slate-900">
                            <h2 className="text-xl font-bold text-white flex items-center gap-2"><ImageIcon size={20} className="text-yellow-500" /> –ú–∞–≥–∞–∑–∏–Ω —Ä–∞–º–æ–∫</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><X size={24} /></button>
                        </div>
                        <div className="p-6 overflow-y-auto custom-scrollbar flex-1 bg-slate-900">
                            <div className="text-center mb-6">
                                <p className="text-slate-400">
                                    {currentUser === 'kayivi' ? (
                                        <span className="text-yellow-500 flex items-center justify-center gap-2">
                                            <Crown size={16} /> –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±–∏—Ä–∞—Ç—å —Ä–∞–º–∫–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ!
                                        </span>
                                    ) : (
                                        <span>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–º–∫—É –¥–ª—è –ø–æ–∫—É–ø–∫–∏</span>
                                    )}
                                </p>
                                <p className="text-sm text-slate-500 mt-2">–í–∞—à–∏ –∫–æ–∏–Ω—ã: <span className="text-yellow-500 font-bold">{userCoins.toFixed(3)}</span></p>
                            </div>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                {frames.map((frame) => {
                                    const canAfford = userCoins >= frame.price || currentUser === 'kayivi';
                                    const isLocked = !canAfford && currentUser !== 'kayivi' && frame.price > 0;
                                    
                                    return (
                                        <button
                                            key={frame.id}
                                            onClick={() => !isLocked && handleFrameSelect(frame)}
                                            disabled={isLoading || isLocked}
                                            className={`p-4 rounded-xl flex flex-col items-center gap-3 transition-all duration-200 ${
                                                isLocked 
                                                    ? 'bg-slate-800 border-2 border-slate-700 avatar-locked' 
                                                    : userFrame === frame.id 
                                                    ? 'bg-slate-700 border-2 border-yellow-500' 
                                                    : 'bg-slate-800 hover:bg-slate-700 border-2 border-slate-600 hover:border-yellow-500 hover:scale-105'
                                            }`}
                                        >
                                            <div className={`w-16 h-16 rounded-full bg-gradient-to-tr from-indigo-600 to-purple-600 flex items-center justify-center text-white font-bold text-2xl ${frame.className}`}>
                                                {currentUser[0].toUpperCase()}
                                            </div>
                                            <div className="text-center">
                                                <h3 className="font-medium text-white">{frame.name}</h3>
                                                <p className="text-sm text-slate-400">
                                                    {frame.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : 
                                                     currentUser === 'kayivi' ? <span className="text-yellow-500">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span> :
                                                     `${frame.price} –∫–æ–∏–Ω–æ–≤`}
                                                </p>
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5. Clicker Component
        const Clicker = ({ userCoins, onCoinClick, currentUser }) => {
            const [showCoin, setShowCoin] = useState(false);
            const [coinPosition, setCoinPosition] = useState({ x: 0, y: 0 });

            const handleClick = (e) => {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                setCoinPosition({ x, y });
                setShowCoin(true);
                onCoinClick();
                
                setTimeout(() => setShowCoin(false), 500);
            };

            return (
                <div className="relative">
                    {showCoin && (
                        <div 
                            className="absolute text-yellow-500 text-2xl font-bold coin-animation z-50"
                            style={{ left: coinPosition.x, top: coinPosition.y }}
                        >
                            +0.001
                        </div>
                    )}
                    <button
                        onClick={handleClick}
                        className="w-full bg-gradient-to-br from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-white p-6 rounded-2xl shadow-2xl shadow-yellow-500/25 transition-all duration-200 active:scale-95 border-2 border-yellow-400/50 animate-pulse-gold"
                    >
                        <div className="text-center">
                            <Coins size={48} className="mx-auto mb-2" />
                            <div className="text-2xl font-bold mb-1">{userCoins.toFixed(3)}</div>
                            <div className="text-yellow-200 text-sm">–ö–ª–∏–∫–Ω–∏ –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞!</div>
                            <div className="text-yellow-300/80 text-xs mt-1">+0.001 –∑–∞ –∫–ª–∏–∫</div>
                        </div>
                    </button>
                </div>
            );
        };

        // Helper function to get frame class
        const getFrameClass = (frameId) => {
            switch(frameId) {
                case 'basic': return 'frame-basic';
                case 'silver': return 'frame-silver';
                case 'gold': return 'frame-gold';
                case 'diamond': return 'frame-diamond';
                case 'rainbow': return 'frame-rainbow';
                default: return '';
            }
        };

        // --- Main App ---
        const App = () => {
            const [currentUser, setCurrentUser] = useState(() => localStorage.getItem('dolbaeb_user'));
            const [isLoginView, setIsLoginView] = useState(true);
            const [usernameInput, setUsernameInput] = useState('');
            const [passwordInput, setPasswordInput] = useState('');
            const [authError, setAuthError] = useState('');
            const [chats, setChats] = useState([]);
            const [areChatsLoading, setAreChatsLoading] = useState(false);
            const [activeChatUser, setActiveChatUser] = useState(null);
            const [messages, setMessages] = useState([]);
            const [messageInput, setMessageInput] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [isAvatarModalOpen, setIsAvatarModalOpen] = useState(false);
            const [isFrameModalOpen, setIsFrameModalOpen] = useState(false);
            const [isCasinoOpen, setIsCasinoOpen] = useState(false);
            const [showMobileSidebar, setShowMobileSidebar] = useState(true);
            const [isRecording, setIsRecording] = useState(false);
            const [connectionError, setConnectionError] = useState('');
            const [userCoins, setUserCoins] = useState(0);
            const [userAvatar, setUserAvatar] = useState('');
            const [userFrame, setUserFrame] = useState('');
            const [usersData, setUsersData] = useState({});
            const mediaRecorderRef = useRef(null);
            const messagesEndRef = useRef(null);

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            useEffect(() => {
                if (currentUser) {
                    const userRef = ref(db, `users/${currentUser}`);
                    const unsubscribe = onValue(userRef, (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            setUserCoins(data.coins || 0);
                            setUserAvatar(data.avatar || '');
                            setUserFrame(data.frame || '');
                        }
                    });
                    
                    return () => off(userRef);
                }
            }, [currentUser]);

            // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏...
            // (–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –∑–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π)

            // –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –æ—Å—Ç–∞–≤–ª—é —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–¥—É

            return (
                <div className="flex h-screen overflow-hidden bg-slate-950">
                    <CasinoModal 
                        isOpen={isCasinoOpen}
                        onClose={() => setIsCasinoOpen(false)}
                        currentUser={currentUser}
                        userCoins={userCoins}
                        onCoinsUpdate={setUserCoins}
                    />
                    
                    {/* –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞... */}
                    
                    {/* Sidebar */}
                    <div className={`${showMobileSidebar ? 'flex' : 'hidden'} md:flex w-full md:w-[420px] flex-col border-r border-slate-800 bg-slate-900 z-10`}>
                        <div className="p-4 border-b border-slate-800 flex items-center justify-between h-[72px]">
                            <div className="flex items-center gap-3">
                                <button 
                                    onClick={() => setIsAvatarModalOpen(true)}
                                    className={`w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-600 to-purple-600 flex items-center justify-center text-white font-bold text-lg relative group ${getFrameClass(userFrame)}`}
                                >
                                    {userAvatar || currentUser[0].toUpperCase()}
                                </button>
                                <div>
                                    <h2 className="font-bold text-white flex items-center gap-1">
                                        {currentUser}
                                        {currentUser === 'kayivi' && <Crown size={14} className="text-yellow-500" />}
                                    </h2>
                                    <span className="text-[11px] text-green-500 flex items-center gap-1">‚óè –í —Å–µ—Ç–∏</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button 
                                    onClick={() => setIsCasinoOpen(true)}
                                    className="p-2 rounded-xl bg-slate-800 text-slate-400 hover:text-yellow-400 relative"
                                    title="–ö–∞–∑–∏–Ω–æ"
                                >
                                    <Dice5 size={20} />
                                </button>
                                <button 
                                    onClick={() => setIsFrameModalOpen(true)}
                                    className="p-2 rounded-xl bg-slate-800 text-slate-400 hover:text-white relative"
                                >
                                    <ImageIcon size={20} />
                                </button>
                                <button 
                                    onClick={() => setIsSettingsOpen(true)}
                                    className="p-2 rounded-xl bg-slate-800 text-slate-400 hover:text-white relative"
                                >
                                    <SettingsIcon size={20} />
                                </button>
                            </div>
                        </div>

                        {/* Clicker Section */}
                        <div className="p-4 border-b border-slate-800">
                            <Clicker 
                                userCoins={userCoins} 
                                onCoinClick={handleCoinClick}
                                currentUser={currentUser}
                            />
                        </div>

                        {/* –û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å sidebar... */}
                    </div>

                    {/* Chat Area... */}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
