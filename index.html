<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>METH</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- PeerJS -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    
    <!-- Fonts & Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #09090b;       /* Почти черный */
            --sidebar: #000000;  /* Черный */
            --border: #27272a;   /* Темно-серый */
            --text: #e4e4e7;     /* Светло-серый */
            --text-dim: #71717a; /* Тусклый */
            --accent: #ffffff;   /* Акцент - белый */
            --danger: #ef4444;
            --font: 'Inter', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; font-family: var(--font); }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; font-size: 14px; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        /* --- AUTH (CLEAN) --- */
        #auth-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: var(--bg); display: flex; justify-content: center; align-items: center;
        }
        .auth-form { width: 320px; text-align: center; }
        .auth-logo { font-size: 24px; font-weight: 600; margin-bottom: 40px; letter-spacing: -1px; }
        .minimal-inp {
            width: 100%; background: transparent; border: none; border-bottom: 1px solid #333;
            color: white; padding: 15px 0; font-size: 14px; margin-bottom: 10px; transition: 0.3s;
        }
        .minimal-inp:focus { border-color: white; }
        .minimal-btn {
            width: 100%; background: white; color: black; border: none; padding: 15px;
            font-weight: 500; cursor: pointer; margin-top: 20px; border-radius: 4px; transition: 0.2s;
        }
        .minimal-btn:hover { opacity: 0.9; }

        /* --- MAIN LAYOUT --- */
        #app { display: none; width: 100%; height: 100%; }

        /* 1. NAV RAIL (ICONS) */
        .nav-rail {
            width: 60px; background: var(--sidebar); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 10px;
        }
        .nav-item {
            width: 40px; height: 40px; border-radius: 8px; display: grid; place-items: center;
            color: var(--text-dim); cursor: pointer; transition: 0.2s;
        }
        .nav-item:hover { color: white; background: #222; }
        .nav-item.active { color: black; background: white; }

        /* 2. SIDE LIST (CONTACTS) */
        .side-list {
            width: 240px; background: var(--bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
        }
        .side-header {
            padding: 20px; font-weight: 600; font-size: 13px; letter-spacing: -0.5px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .contact-item {
            padding: 12px 20px; display: flex; align-items: center; gap: 10px;
            cursor: pointer; color: var(--text-dim); transition: 0.2s;
        }
        .contact-item:hover { background: #18181b; color: white; }
        .user-status-dot { width: 6px; height: 6px; border-radius: 50%; background: #333; }
        .user-status-dot.online { background: #10b981; }

        /* 3. CONTENT AREA */
        .content { flex: 1; display: flex; flex-direction: column; background: var(--bg); position: relative; }
        
        /* CHAT */
        .chat-scroll { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 20px; }
        .msg-block { display: flex; gap: 15px; }
        .msg-avatar { 
            width: 32px; height: 32px; background: #222; border-radius: 50%; 
            display: grid; place-items: center; font-size: 12px; font-weight: 600; color: #fff;
        }
        .msg-body { flex: 1; }
        .msg-header { font-size: 13px; font-weight: 600; margin-bottom: 4px; color: white; }
        .msg-time { font-size: 11px; color: #555; font-weight: 400; margin-left: 8px; }
        .msg-text { 
            font-size: 14px; color: #d4d4d8; line-height: 1.5; 
            background: #18181b; padding: 8px 12px; border-radius: 0 8px 8px 8px; display: inline-block;
        }
        
        .input-area {
            padding: 20px; border-top: 1px solid var(--border); display: flex; gap: 10px;
        }
        .clean-inp {
            flex: 1; background: #18181b; border: 1px solid transparent; color: white;
            padding: 12px; border-radius: 6px; font-size: 14px;
        }
        .clean-inp:focus { background: #222; }
        .clean-btn {
            background: transparent; border: none; color: var(--text-dim); cursor: pointer; padding: 0 10px;
        }
        .clean-btn:hover { color: white; }

        /* CALL POPUP (Minimal) */
        #call-popup {
            position: fixed; bottom: 30px; right: 30px; width: 320px;
            background: #111; border: 1px solid #333; border-radius: 12px;
            overflow: hidden; display: none; z-index: 5000; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .video-wrapper { position: relative; height: 200px; background: black; }
        video { width: 100%; height: 100%; object-fit: cover; }
        #local-vid {
            position: absolute; bottom: 15px; right: 15px; width: 80px; height: 60px;
            background: #222; border-radius: 6px; transform: scaleX(-1); border: 1px solid #444;
        }
        .call-actions {
            display: flex; justify-content: center; gap: 15px; padding: 15px; background: #111;
        }
        .circle-btn {
            width: 40px; height: 40px; border-radius: 50%; background: #222; border: none;
            color: white; cursor: pointer; transition: 0.2s; display: grid; place-items: center;
        }
        .circle-btn:hover { background: #333; }
        .circle-btn.red { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .circle-btn.red:hover { background: #ef4444; color: white; }
        .circle-btn.active { background: white; color: black; }

        /* IFRAMES */
        .iframe-full { width: 100%; height: 100%; border: none; display: none; }
        .url-header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 10px; }

        /* MODAL */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 6000;
            display: none; place-items: center;
        }
        .modal-box { background: #111; padding: 30px; border-radius: 12px; width: 350px; border: 1px solid #333; }
    </style>
</head>
<body>

<!-- AUTH -->
<div id="auth-screen">
    <div class="auth-form">
        <div class="auth-logo">METH</div>
        <input type="text" id="username" class="minimal-inp" placeholder="Username" autocomplete="off">
        <input type="password" id="password" class="minimal-inp" placeholder="Password">
        <div id="auth-error" style="color:var(--danger); font-size:12px; margin-top:10px;"></div>
        <button class="minimal-btn" onclick="authFunc('login')">Login</button>
        <button class="minimal-btn" onclick="authFunc('register')" style="background:transparent; color:#666; margin-top:0;">Create Account</button>
    </div>
</div>

<!-- INCOMING CALL -->
<div class="modal" id="incoming-modal">
    <div class="modal-box" style="text-align:center;">
        <h3 style="margin-bottom:20px;">Incoming Call</h3>
        <div id="caller-name" style="margin-bottom:30px; color:#888;">User</div>
        <div style="display:flex; gap:10px; justify-content:center;">
            <button class="minimal-btn" style="background:#10b981; color:white; padding:10px 30px;" onclick="answerCall()">Answer</button>
            <button class="minimal-btn" style="background:#ef4444; color:white; padding:10px 30px;" onclick="rejectCall()">Decline</button>
        </div>
    </div>
</div>

<!-- APP -->
<div id="app">
    <!-- 1. Nav -->
    <div class="nav-rail">
        <div class="nav-item active" onclick="switchTab('chat')"><i class="fas fa-comment"></i></div>
        <div class="nav-item" onclick="switchTab('spotify')"><i class="fab fa-spotify"></i></div>
        <div class="nav-item" onclick="switchTab('youtube')"><i class="fab fa-youtube"></i></div>
        <div class="nav-item" onclick="switchTab('browser')"><i class="fas fa-compass"></i></div>
        <div style="flex:1;"></div>
        <div class="nav-item" onclick="document.getElementById('settings-modal').style.display='grid'"><i class="fas fa-sliders-h"></i></div>
    </div>

    <!-- 2. Sidebar -->
    <div class="side-list">
        <div class="side-header">
            <span>CONTACTS</span>
            <button onclick="addFriendInput()" style="background:none; border:none; color:white; cursor:pointer;">+</button>
        </div>
        
        <div id="add-friend-box" style="padding:10px; display:none; border-bottom:1px solid #222;">
            <input id="friend-inp" type="text" placeholder="username..." style="background:#111; border:none; color:white; padding:5px; width:100%;">
            <button onclick="addFriendAndCall()" style="width:100%; margin-top:5px; background:white; border:none; cursor:pointer; font-size:10px; padding:4px;">ADD</button>
        </div>

        <div id="friends-list" style="flex:1; overflow-y:auto;">
            <!-- Friends here -->
        </div>

        <div style="padding:15px; border-top:1px solid var(--border); display:flex; align-items:center; gap:10px;">
            <div class="user-status-dot" id="status-dot"></div>
            <div style="flex:1;">
                <div style="font-weight:600; font-size:12px;" id="my-name">...</div>
                <div style="font-size:10px; color:#555;" id="my-status">Offline</div>
            </div>
            <i class="fas fa-redo" style="cursor:pointer; font-size:10px; color:#555;" onclick="reconnectPeer()"></i>
        </div>
    </div>

    <!-- 3. Content -->
    <div class="content">
        
        <!-- Chat -->
        <div id="tab-chat" style="display:flex; flex-direction:column; height:100%;">
            <div class="side-header" style="border-bottom:1px solid var(--border);">GENERAL</div>
            <div class="chat-scroll" id="msg-container"></div>
            <div class="input-area">
                <button class="clean-btn" onclick="document.getElementById('file-in').click()"><i class="fas fa-plus"></i></button>
                <input type="file" id="file-in" hidden onchange="uploadFile()">
                <input type="text" class="clean-inp" id="msg-in" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="clean-btn" onclick="sendMessage()"><i class="fas fa-arrow-up"></i></button>
            </div>
        </div>

        <!-- Apps -->
        <div id="tab-spotify" class="iframe-full" style="flex-direction:column;">
            <div class="url-header"><input id="spot-url" class="clean-inp" placeholder="Spotify Link"><button class="minimal-btn" style="width:auto; margin:0; padding:10px;" onclick="loadSpotify()">Load</button></div>
            <iframe id="frame-spotify" style="flex:1; border:none;" src="https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M"></iframe>
        </div>

        <div id="tab-youtube" class="iframe-full" style="flex-direction:column;">
            <div class="url-header"><input id="yt-url" class="clean-inp" placeholder="YouTube Search"><button class="minimal-btn" style="width:auto; margin:0; padding:10px;" onclick="loadYoutube()">Watch</button></div>
            <iframe id="frame-youtube" style="flex:1; border:none;" src="https://www.youtube.com/embed/dQw4w9WgXcQ"></iframe>
        </div>

        <div id="tab-browser" class="iframe-full" style="flex-direction:column;">
            <div class="url-header"><input id="web-url" class="clean-inp" placeholder="URL"><button class="minimal-btn" style="width:auto; margin:0; padding:10px;" onclick="loadWeb()">Go</button></div>
            <iframe id="frame-web" style="flex:1; border:none;" src="https://www.bing.com"></iframe>
        </div>

    </div>
</div>

<!-- CALL POPUP -->
<div id="call-popup">
    <div class="video-wrapper">
        <video id="remote-vid" autoplay playsinline></video>
        <video id="local-vid" autoplay muted playsinline></video>
    </div>
    <div class="call-actions">
        <button class="circle-btn" onclick="toggleMic()" id="btn-mic"><i class="fas fa-microphone"></i></button>
        <button class="circle-btn" onclick="toggleDeafen()" id="btn-deaf"><i class="fas fa-volume-up"></i></button>
        <button class="circle-btn" onclick="shareScreen()" id="btn-screen"><i class="fas fa-desktop"></i></button>
        <button class="circle-btn red" onclick="endCall()"><i class="fas fa-phone-slash"></i></button>
    </div>
</div>

<!-- SETTINGS -->
<div class="modal" id="settings-modal">
    <div class="modal-box">
        <h3 style="margin-bottom:20px;">Settings</h3>
        <label style="font-size:12px; color:#666;">Audio Input</label>
        <select id="mic-select" class="minimal-inp" style="background:#111; padding:10px; border:1px solid #333;"><option>Default</option></select>
        <button class="minimal-btn" style="background:#222; color:white; margin-top:20px;" onclick="document.getElementById('settings-modal').style.display='none'">Close</button>
        <button class="minimal-btn" style="background:#ef4444; color:white; margin-top:10px;" onclick="logout()">Log Out</button>
    </div>
</div>

<script>
    // --- 1. SETUP ---
    const firebaseConfig = {
      apiKey: "AIzaSyBFAWc-An48eKYfTMGhlJICkDPdecEJbb4",
      authDomain: "kolyasurfing-1a685.firebaseapp.com",
      databaseURL: "https://kolyasurfing-1a685-default-rtdb.firebaseio.com",
      projectId: "kolyasurfing-1a685",
      storageBucket: "kolyasurfing-1a685.firebasestorage.app",
      messagingSenderId: "1039204722214",
      appId: "1:1039204722214:web:0f441d51b176645e3ea8e7"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    
    let currentUser = null, peer = null, currentCall = null, localStream = null;
    let isMicMuted = false, isDeafened = false;

    // --- 2. AUTH ---
    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            
            const cleanId = user.email.split('@')[0];
            document.getElementById('my-name').innerText = cleanId;
            
            initPeer(cleanId);
            loadChat();
            loadFriends();
            updateMics();
            cleanMsgs();
        } else {
            document.getElementById('auth-screen').style.display = 'flex';
        }
    });

    async function authFunc(type) {
        const nick = document.getElementById('username').value.trim().toLowerCase().replace(/[^a-z0-9]/g, '');
        const pass = document.getElementById('password').value;
        const email = nick + "@meth.app";

        try {
            if(type === 'register') {
                await auth.createUserWithEmailAndPassword(email, pass);
                await db.collection('users').doc(nick).set({ uid: auth.currentUser.uid });
            } else await auth.signInWithEmailAndPassword(email, pass);
        } catch(e) { document.getElementById('auth-error').innerText = e.message; }
    }
    function logout() { auth.signOut(); location.reload(); }

    // --- 3. NETWORK (PEER) ---
    function initPeer(id) {
        if(peer) peer.destroy();
        peer = new Peer(id, {
            secure: true, debug: 1,
            config: {'iceServers': [{urls:'stun:stun.l.google.com:19302'},{urls:'stun:global.stun.twilio.com:3478'}]}
        });
        peer.on('open', () => {
            document.getElementById('my-status').innerText = "Online";
            document.getElementById('status-dot').classList.add('online');
        });
        peer.on('error', () => {
            document.getElementById('my-status').innerText = "Network Error";
            document.getElementById('status-dot').classList.remove('online');
        });
        peer.on('call', call => {
            document.getElementById('incoming-modal').style.display = 'flex';
            document.getElementById('caller-name').innerText = call.peer;
            currentCall = call;
        });
    }
    function reconnectPeer() { if(currentUser) initPeer(currentUser.email.split('@')[0]); }

    // --- 4. CALLS (FIXED) ---
    async function startStream(video=true) {
        const mic = document.getElementById('mic-select').value;
        let conf = { echoCancellation: true, noiseSuppression: true };
        if(mic !== 'Default') conf.deviceId = { exact: mic };

        try {
            const s = await navigator.mediaDevices.getUserMedia({ video: video, audio: conf });
            document.getElementById('local-vid').srcObject = s;
            document.getElementById('local-vid').style.display = 'block';
            return s;
        } catch(e) {
            if(video) {
                try {
                    // Fallback to audio only
                    const as = await navigator.mediaDevices.getUserMedia({ video: false, audio: conf });
                    document.getElementById('local-vid').style.display = 'none';
                    return as;
                } catch(e2) { alert("Mic Access Denied"); return null; }
            }
            return null;
        }
    }

    async function makeCall(id) {
        if(id === currentUser.email.split('@')[0]) return;
        const s = await startStream(true);
        if(!s) return;
        
        document.getElementById('call-popup').style.display = 'block';
        const call = peer.call(id, s);
        handleCall(call);
    }
    
    async function answerCall() {
        document.getElementById('incoming-modal').style.display = 'none';
        const s = await startStream(true);
        if(!s) return;
        
        document.getElementById('call-popup').style.display = 'block';
        currentCall.answer(s);
        handleCall(currentCall);
    }
    
    function rejectCall() {
        document.getElementById('incoming-modal').style.display = 'none';
        if(currentCall) currentCall.close();
    }

    function handleCall(call) {
        currentCall = call;
        call.on('stream', rs => document.getElementById('remote-vid').srcObject = rs);
        call.on('close', closeCallUI);
        call.on('error', closeCallUI);
    }

    function endCall() { if(currentCall) currentCall.close(); closeCallUI(); }
    
    function closeCallUI() {
        document.getElementById('call-popup').style.display = 'none';
        if(localStream) localStream.getTracks().forEach(t=>t.stop());
        document.getElementById('remote-vid').srcObject = null;
        currentCall = null;
    }

    // Media Controls
    function toggleMic() {
        if(!localStream) return;
        const t = localStream.getAudioTracks()[0];
        isMicMuted = !isMicMuted; t.enabled = !isMicMuted;
        document.getElementById('btn-mic').classList.toggle('red', isMicMuted);
    }
    function toggleDeafen() {
        const v = document.getElementById('remote-vid');
        isDeafened = !isDeafened; v.muted = isDeafened;
        document.getElementById('btn-deaf').classList.toggle('red', isDeafened);
    }
    async function shareScreen() {
        try {
            const ss = await navigator.mediaDevices.getDisplayMedia({video:true,audio:true});
            const sender = currentCall.peerConnection.getSenders().find(s=>s.track.kind==='video');
            if(sender) sender.replaceTrack(ss.getVideoTracks()[0]);
            document.getElementById('local-vid').srcObject = ss;
            document.getElementById('btn-screen').classList.add('active');
            
            ss.getVideoTracks()[0].onended = () => {
                startStream(true).then(cs => {
                    if(sender) sender.replaceTrack(cs.getVideoTracks()[0]);
                    document.getElementById('btn-screen').classList.remove('active');
                });
            };
        } catch(e){}
    }

    // --- 5. UI & DATA ---
    function addFriendInput() {
        const box = document.getElementById('add-friend-box');
        box.style.display = box.style.display==='none'?'block':'none';
    }
    function addFriendAndCall() {
        const id = document.getElementById('friend-inp').value.trim().toLowerCase();
        if(!id) return;
        let fs = JSON.parse(localStorage.getItem('meth_friends')||'[]');
        if(!fs.includes(id)) { fs.push(id); localStorage.setItem('meth_friends',JSON.stringify(fs)); loadFriends(); }
    }
    function loadFriends() {
        const l = document.getElementById('friends-list'); l.innerHTML='';
        const fs = JSON.parse(localStorage.getItem('meth_friends')||'[]');
        fs.forEach(f=>{
            const d = document.createElement('div'); d.className='contact-item';
            d.innerHTML=`
                <div style="width:24px;height:24px;background:#222;border-radius:50%;display:grid;place-items:center;font-size:10px;">${f[0].toUpperCase()}</div>
                <div style="flex:1;font-size:13px;">${f}</div>
                <i class="fas fa-phone" onclick="makeCall('${f}')" style="font-size:10px;"></i>
                <i class="fas fa-times" onclick="delFriend('${f}')" style="font-size:10px;margin-left:5px;"></i>`;
            l.appendChild(d);
        });
    }
    function delFriend(id) {
        let fs = JSON.parse(localStorage.getItem('meth_friends')||'[]');
        fs = fs.filter(x=>x!==id); localStorage.setItem('meth_friends',JSON.stringify(fs)); loadFriends();
    }

    // --- 6. CHAT ---
    function sendMessage() {
        const t = document.getElementById('msg-in').value.trim();
        if(!t) return;
        db.collection('messages').add({
            text:t, uid:currentUser.uid, user:currentUser.email.split('@')[0],
            ts:firebase.firestore.FieldValue.serverTimestamp(), type:'text'
        });
        document.getElementById('msg-in').value='';
    }
    function uploadFile() {
        const f = document.getElementById('file-in').files[0];
        if(!f) return;
        const ref = storage.ref('u/'+Date.now());
        ref.put(f).then(s=>s.ref.getDownloadURL()).then(u=>{
            db.collection('messages').add({
                text:u, uid:currentUser.uid, user:currentUser.email.split('@')[0],
                ts:firebase.firestore.FieldValue.serverTimestamp(), type:f.type.startsWith('image')?'image':'file'
            });
        });
    }
    function loadChat() {
        db.collection('messages').orderBy('ts','asc').limitToLast(50).onSnapshot(s=>{
            const c = document.getElementById('msg-container'); c.innerHTML='';
            s.forEach(d=>{
                const dt = d.data();
                const div = document.createElement('div'); div.className='msg-block';
                let content = dt.type==='image'?`<img src="${dt.text}" style="max-width:200px;border-radius:8px;">` :
                              (dt.type==='file'?`<a href="${dt.text}" target="_blank" style="color:white;text-decoration:underline;">File</a>` : linkify(dt.text));
                
                div.innerHTML = `
                    <div class="msg-avatar">${dt.user[0].toUpperCase()}</div>
                    <div class="msg-body">
                        <div class="msg-header">${dt.user} <span class="msg-time">${dt.ts?new Date(dt.ts.toDate()).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}):''}</span></div>
                        <div class="msg-text">${content}</div>
                    </div>`;
                c.appendChild(div);
            });
            c.scrollTop = c.scrollHeight;
        });
    }
    function linkify(t) { return t.replace(/(https?:\/\/[^\s]+)/g, u=>`<a href="${u}" target="_blank" style="color:#aaa;">${u}</a>`); }
    async function cleanMsgs() {
        const d=new Date(); d.setDate(d.getDate()-2);
        const s = await db.collection('messages').where('ts','<',d).get();
        const b = db.batch(); s.forEach(doc=>b.delete(doc.ref)); await b.commit();
    }

    // --- 7. TABS ---
    function switchTab(t) {
        document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('tab-chat').style.display='none';
        document.querySelectorAll('.iframe-full').forEach(e=>e.style.display='none');
        
        if(t==='chat') document.getElementById('tab-chat').style.display='flex';
        else document.getElementById('tab-'+t).style.display='flex';
    }
    function loadSpotify(){ let v=document.getElementById('spot-url').value; if(v&&!v.includes('embed'))v=v.replace('open.spotify.com/','open.spotify.com/embed/'); document.getElementById('frame-spotify').src=v||"https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M"; }
    function loadYoutube(){ let v=document.getElementById('yt-url').value; if(v.includes('watch?v='))v=v.replace('watch?v=','embed/'); else if(!v.includes('http')) v='https://www.youtube.com/embed?listType=search&list='+v; document.getElementById('frame-youtube').src=v; }
    function loadWeb(){ document.getElementById('frame-web').src=document.getElementById('web-url').value; }
    
    async function updateMics() {
        try { await navigator.mediaDevices.getUserMedia({audio:true});
        const ds=await navigator.mediaDevices.enumerateDevices();
        const s=document.getElementById('mic-select'); s.innerHTML='<option>Default</option>';
        ds.filter(d=>d.kind==='audioinput').forEach(d=>{
            const o=document.createElement('option'); o.value=d.deviceId; o.text=d.label; s.appendChild(o);
        }); }catch(e){}
    }
</script>
</body>
</html>
